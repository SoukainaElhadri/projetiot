{% extends 'base.html' %}
{% load static %}
{% block i %}

<link rel="stylesheet" href="{% static 'css/charts.css' %}">
<style>
  /* Green theme */
  .period-btn.active {
    background-color: rgba(34, 197, 94, 0.2) !important;
    border-color: rgb(34, 197, 94) !important;
    color: rgb(21, 128, 61) !important;
  }
  
  .period-btn {
    background-color: white !important;
    border: 2px solid #e5e7eb !important;
    color: #374151 !important;
  }
  
  .period-btn:hover:not(.active) {
    background-color: rgba(34, 197, 94, 0.1) !important;
    border-color: rgb(134, 239, 172) !important;
    color: rgb(21, 128, 61) !important;
  }
  
  .action-btn {
    background-color: rgb(34, 197, 94) !important;
    border-color: rgb(22, 163, 74) !important;
    color: white !important;
  }
  
  .action-btn:hover {
    background-color: rgb(22, 163, 74) !important;
    border-color: rgb(21, 128, 61) !important;
  }
  
  .stat-card:first-child {
    border-top: 4px solid rgb(34, 197, 94) !important;
  }
</style>

<div class="dashboard-container hum">
  <div class="header-section">
    <h1 class="title">ğŸ“Š Tableau de Bord HumiditÃ©</h1>
    <p class="subtitle">Suivez l'humiditÃ© en temps rÃ©el et analysez les tendances</p>
  </div>

  <div class="controls-container">
    <div class="period-controls">
      <button class="period-btn active" id="btn-jour-hum" data-period="jour">
        <span class="btn-icon">ğŸ“…</span> Aujourd'hui
      </button>
      <button class="period-btn" id="btn-semaine-hum" data-period="semaine">
        <span class="btn-icon">ğŸ“†</span> Cette semaine
      </button>
      <button class="period-btn" id="btn-mois-hum" data-period="mois">
        <span class="btn-icon">ğŸ“Š</span> Ce mois
      </button>
    </div>

    <div class="date-controls">
      <div class="date-input-group">
        <label for="date-input-hum">ğŸ“… Date spÃ©cifique :</label>
        <input type="date" id="date-input-hum" class="date-input" />
      </div>
      <button class="action-btn" id="btn-date-hum">
        <span class="btn-icon">ğŸ”</span> Afficher
      </button>
    </div>
  </div>

  <div class="period-display">
    <p class="period-text" id="periode-hum">Chargement des donnÃ©es...</p>
  </div>

  <div class="stats-container">
    <div class="stat-card">
      <div class="stat-value" id="current-value">--%</div>
      <div class="stat-label">HumiditÃ© actuelle</div>
    </div>
    <div class="stat-card">
      <div class="stat-value" id="avg-value">--%</div>
      <div class="stat-label">Moyenne</div>
    </div>
    <div class="stat-card">
      <div class="stat-value" id="min-value">--%</div>
      <div class="stat-label">Minimum</div>
    </div>
    <div class="stat-card">
      <div class="stat-value" id="max-value">--%</div>
      <div class="stat-label">Maximum</div>
    </div>
  </div>

  <div class="chart-container">
    <div class="loading-overlay" id="loading-overlay">
      <div class="spinner"></div>
      <div class="loading-text">Chargement des donnÃ©es...</div>
    </div>
    <canvas id="graphique-hum"></canvas>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/moment.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-moment@0.1.1/dist/chartjs-adapter-moment.min.js"></script>
<script src="{% static 'js/charts.js' %}"></script>

<script>
// Green theme
document.addEventListener('DOMContentLoaded', function() {
  // Store original chart creation function
  const originalCreateChart = window.createHumidityChart;
  
  if (originalCreateChart) {
    window.createHumidityChart = function(data, period) {
      // Call original function
      const chart = originalCreateChart(data, period);
      
      // Update colors to green theme
      if (chart && chart.data && chart.data.datasets) {
        chart.data.datasets.forEach(dataset => {
          // Main line color - various shades of green
          if (dataset.borderColor) {
            dataset.borderColor = 'rgba(34, 197, 94, 0.8)'; // Green-500
            dataset.backgroundColor = 'rgba(34, 197, 94, 0.1)';
          }
          
          // For point backgrounds
          if (dataset.pointBackgroundColor) {
            dataset.pointBackgroundColor = 'rgba(22, 163, 74, 0.9)'; // Green-600
          }
        });
        
        chart.update();
      }
      
      return chart;
    };
  }
  
  // Update button active state colors
  document.querySelectorAll('.period-btn').forEach(btn => {
    btn.addEventListener('click', function() {
      // Remove active class from all buttons
      document.querySelectorAll('.period-btn').forEach(b => {
        b.classList.remove('active');
        b.style.backgroundColor = '';
      });
      
      // Add active class to clicked button with green color
      this.classList.add('active');
      this.style.backgroundColor = 'rgba(34, 197, 94, 0.2)';
      this.style.borderColor = 'rgb(34, 197, 94)';
    });
  });
  
  // Initialize active button with green color
  const activeBtn = document.querySelector('.period-btn.active');
  if (activeBtn) {
    activeBtn.style.backgroundColor = 'rgba(34, 197, 94, 0.2)';
    activeBtn.style.borderColor = 'rgb(34, 197, 94)';
  }
  
  // Update action button color
  const actionBtn = document.getElementById('btn-date-hum');
  if (actionBtn) {
    actionBtn.style.backgroundColor = 'rgb(34, 197, 94)';
    actionBtn.style.borderColor = 'rgb(22, 163, 74)';
  }
  
  // Update stat cards with green accents
  document.querySelectorAll('.stat-card').forEach(card => {
    const valueElement = card.querySelector('.stat-value');
    if (valueElement && valueElement.id === 'current-value') {
      card.style.borderTop = '4px solid rgb(34, 197, 94)';
    }
  });
});
</script>

{% endblock %}